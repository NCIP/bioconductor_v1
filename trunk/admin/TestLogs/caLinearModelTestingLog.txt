caLinearModel Testing Log

Below is a summary of what I've done to test the caGeneFilter service.  Each test is in the format of:

<Test Title>
Test: <Test Description>
Result: <Test Result>
<STATUS: PASS\FAIL>



#################################################
# Test Date(s): 5/27 - 5/29/2009
# Version: caLinearModel ??? (no method to get R Session Info yet)
# 
#################################################

NOTE:  When the Result is "Results between webservice and using limma in an interactive R session are identical" - there are two exceptions:
	* R returns fewer digits than the webservice
	* The webservice results are missing the AveExpr column


TTest
Test: TTest
	Parameter(s): Contrast: High - Low
	Input File(s): caLinearModelTestFile_mini.txt
Result:  Results between webservice and using limma in an interactive R session are identical
	caLinearModel Result File: ttest_results.txt
	R Result File: R_tTest_high-low.txt
		R code:
		library(limma)
		d<-read.delim("caLinearModelTestFile_mini.txt")
		design<-cbind(High=c(1,1,1,0,0,0), Low=c(0,0,0,1,1,1))
		d<-data.frame(d[2:ncol(d)], row.names=d$ProbeID)
		fit<-lmFit(d, design)
		cont.matrix<-makeContrasts(HighvsLow=High-Low, levels=design)
		fit2<-contrasts.fit(fit, cont.matrix)
		fit2<-eBayes(fit2)
		ttable<-topTable(fit2, adjust="BH", number=nrow(d))
		write.table(ttable, file="R_tTest_high-low.txt", sep="\t", quote=F, row.names=F)
STATUS: PASS



PairedTTest
Test: PairedTTest
	Parameter(s): Contrast: High - Low
	Input File(s): caLinearModelTestFile_mini.txt
Result:  Results between webservice and using limma in an interactive R session are identical
	caLinearModel Result File: pTtest_results.txt
	R Result File: R_pTtest_high-low.txt
		R code:
		library(limma)
		d<-read.delim("caLinearModelTestFile_mini.txt")
		d<-data.frame(d[2:ncol(d)], row.names=d$ProbeID)
		pair<-factor(c(1,2,3,1,2,3))
		treatment<-factor(c("high","high","high","low","low","low"))
		design<-model.matrix(~pair+treatment)
		#it appears that 'model.matrix' takes the first factor to be the reference by default, 'high'
		#since I'd like to use 'low' as my reference, without altering the order of my samples, in the following two
		#lines I've altered the design matrix accordingly (If there is a better way to do this, please let me know)
		design[,4]<-c(1,1,1,0,0,0)
		colnames(design)[4]<-"treatmenthigh"
		fit<-lmFit(d, design)
		fit<-eBayes(fit)
		ttable<-topTable(fit, adjust="BH", number=nrow(d), coef="treatmenthigh")
		write.table(ttable, file="R_pTtest_high-low.txt", sep="\t", quote=F, row.names=F)
STATUS: PASS	


OneFactorANOVA
Test: OneFactorANOVA
	Parameter(s): Contrast: High - Low
	Input File(s): caLinearModelTestFile_mini.txt
Result:  Results between webservice and using limma in an interactive R session are identical
	caLinearModel Result File: oneFactorANOVA_high-low_results.txt
	R Result File: R_oneFactorANOVA_high-low.txt 
		R code:
		library(limma)
		d<-read.delim("caLinearModelTestFile_mini.txt")
		d<-data.frame(d[2:ncol(d)], row.names=d$ProbeID)
		treatment<-factor(c("high","high","med","med","low","low"))
		design<-model.matrix(~0+treatment)
		colnames(design)<-c("high", "low", "med")
		fit<-lmFit(d, design)
		contrast.matrix<-makeContrasts(high-low, high-med, med-low, levels=design)
		fit2<-contrasts.fit(fit, contrast.matrix)
		fit2<-eBayes(fit2)
		ttable<-topTable(fit2, coef=1, adjust="BH", number=nrow(d))
		write.table(ttable, file="R_oneFactorANOVA_high-low.txt", sep="\t", quote=F, row.names=F)
STATUS: PASS

Test: OneFactorANOVA
	Parameter(s): Contrast: High - Med
	Input File(s): caLinearModelTestFile_mini.txt
Result:  Results between webservice and using limma in an interactive R session are identical
	caLinearModel Result File: oneFactorANOVA_high-medium_results.txt
	R Result File: R_oneFactorANOVA_high-med.txt 
		R code:
		ttable<-topTable(fit2, coef=2, adjust="BH", number=nrow(d))
		write.table(ttable, file="R_oneFactorANOVA_high-med.txt", sep="\t", quote=F, row.names=F)
STATUS: PASS

Test: OneFactorANOVA
	Parameter(s): Contrast: Med - Low
	Input File(s): caLinearModelTestFile_mini.txt
Result:  Results between webservice and using limma in an interactive R session are nearly identical: the signs
on the logFC and t values are inverse between the two results files due to the contrast being different.  Would
one of the two contrasts be preferred over the other?
	caLinearModel Result File: oneFactorANOVA_low-medium_results.txt
	R Result File: R_oneFactorANOVA_med-low.txt 
		R code:
		ttable<-topTable(fit2, coef=3, adjust="BH", number=nrow(d))
		write.table(ttable, file="R_oneFactorANOVA_med-low.txt", sep="\t", quote=F, row.names=F)
STATUS: FAIL - need additional information


TwoFactorANOVA
Test: TwoFactorANOVA
	Parameter(s): 
	Input File(s): 
Result:  
STATUS: There is uncertaintly about how this should be set up.  Would an example of this be what's called
a 'Factorial Design' in the Limma User's Guide?


DyeSwapTTest
Test: DyeSwapTTest
	Parameter(s): Contrast: HighvsLow
	Input File(s): caLinearModelTestFile_channelOne_mini.txt
			     caLinearModelTestFile_channelTwo_mini.txt
Result: Result files are very different from each other.  Also, the nomenclature used the 'Contrast Spec' differs from that
used in the OneChannelModels (High-Low)
	caLinearModel Result File: dyeSwapTtest_results.txt
	R Result File: R_dyeSwapTtest_HighvsLow.txt 
		R code:
		library(limma)
		one<-read.delim("caLinearModelTestFile_channelOne_mini.txt")
		two<-read.delim("caLinearModelTestFile_channelTwo_mini.txt")
		x<-new("RGList")
		g<-data.frame(one[2:ncol(one)], row.names=one$ProbeID)
		r<-data.frame(two[2:ncol(two)], row.names=two$ProbeID)
		x$R<-r
		x$G<-g
		x$genes<-row.names(r)
		MA<-normalizeWithinArrays(x, method="none")
		design<-cbind(DyeEffect=1,HighvsLow=c( 1,1,1,1, -1,-1,-1,-1))
		fit<-lmFit(MA, design)
		fit<-eBayes(fit)
		ttable<-topTable(fit, adjust="BH", coef="HighvsLow")
		write.table(ttable, file="R_dyeSwapTtest_HighvsLow.txt",sep="\t",quote=F, row.names=F)
STATUS: FAIL		
		
Test: DyeSwapTTest
	Parameter(s): Contrast: DyeEffect
	Input File(s): caLinearModelTestFile_channelOne_mini.txt
			     caLinearModelTestFile_channelTwo_mini.txt
Result: This contrast wasn't explicity defined in the java code, so there are no results to compare.  Is this a contrast
that should be included by default?
	caLinearModel Result File: NA
	R Result File: R_dyeSwapTtest_DyeEffect.txt 
		R code:
		ttable<-topTable(fit, adjust="BH", coef="DyeEffect")
		write.table(ttable, file="R_dyeSwapTtest_DyeEffect.txt",sep="\t",quote=F, row.names=F)
STATUS: FAIL


CommonReferenceANOVA
Test: CommonReferenceANOVA
	Parameter(s): Contrast: Low-High 
	Input File(s): caLinearModelTestFile_channelOne_mini.txt
			     caLinearModelTestFile_channelTwo_mini.txt
Result: Result files are very different from each other.  Low-High was the only contrast that was generated by the client by default.  
	caLinearModel Result File: twoChannelCommonReference_results.txt
	R Result File: R_twoChannelCommonReference_results.txt  
		R code:
		library(limma)
		one<-read.delim("caLinearModelTestFile_channelOne_mini.txt")
		two<-read.delim("caLinearModelTestFile_channelTwo_mini.txt")
		x<-new("RGList")
		g<-data.frame(one[2:ncol(one)], row.names=one$ProbeID)
		r<-data.frame(two[2:ncol(two)], row.names=two$ProbeID)
		x$R<-r
		x$G<-g
		x$genes<-row.names(r)
		MA<-normalizeWithinArrays(x, method="none")
		design<-cbind("high-ref"=1, "low-high"=c(0,0,0,0,1,1,1,1))
		fit<-lmFit(MA, design)
		fit<-eBayes(fit)
		topTable(fit, adjust="BH")
		ttable<-topTable(fit, coef=2, adjust="BH")
		write.table(ttable, file="R_twoChannelCommonReference_results.txt", sep="\t", quote=F, row.names=F)
STATUS: FAIL


